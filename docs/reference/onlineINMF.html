<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Perform Integrative Non-negative Matrix Factorization Using Online Learning — onlineINMF • RcppPlanc</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Perform Integrative Non-negative Matrix Factorization Using Online Learning — onlineINMF"><meta property="og:description" content="Performs integrative non-negative matrix factorization (iNMF) (J.D. Welch,
2019, C. Gao, 2021) using online learning approach to return factorized
\(H\), \(W\), and \(V\) matrices. The objective function is stated as
$$\arg\min_{H\ge0,W\ge0,V\ge0}\sum_{i}^{d}||E_i-(W+V_i)Hi||^2_F+
\lambda\sum_{i}^{d}||V_iH_i||_F^2$$
where \(E_i\) is the input non-negative matrix of the \(i\)'th dataset,
\(d\) is the total number of datasets. \(E_i\) is of size
\(m \times n_i\) for \(m\) features and \(n_i\) sample points,
\(H_i\) is of size \(k \times n_i\), \(V_i\) is of size
\(m \times k\), and \(W\) is of size \(m \times k\).
Different from inmf which optimizes the objective with ANLS
approach, onlineINMF optimizes the same objective with online learning
strategy, where it updates mini-batches of \(H_i\) solving the NNLS
problem, and updates \(V_i\) and \(W\) with HALS multiplicative method.
This function allows online learning in 3 scenarios:

Fully observed datasets;
Iterative refinement using continually arriving datasets;
Projection of new datasets without updating the existing factorization

"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RcppPlanc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li class="dropdown-header">Installation</li>
<li class="dropdown-header">Tutorial</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">NEWS</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/welch-lab/liger" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Perform Integrative Non-negative Matrix Factorization Using Online Learning</h1>
    
    <div class="hidden name"><code>onlineINMF.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Performs integrative non-negative matrix factorization (iNMF) (J.D. Welch,
2019, C. Gao, 2021) using online learning approach to return factorized
\(H\), \(W\), and \(V\) matrices. The objective function is stated as</p>
<p>$$\arg\min_{H\ge0,W\ge0,V\ge0}\sum_{i}^{d}||E_i-(W+V_i)Hi||^2_F+
\lambda\sum_{i}^{d}||V_iH_i||_F^2$$</p>
<p>where \(E_i\) is the input non-negative matrix of the \(i\)'th dataset,
\(d\) is the total number of datasets. \(E_i\) is of size
\(m \times n_i\) for \(m\) features and \(n_i\) sample points,
\(H_i\) is of size \(k \times n_i\), \(V_i\) is of size
\(m \times k\), and \(W\) is of size \(m \times k\).</p>
<p>Different from <code><a href="inmf.html">inmf</a></code> which optimizes the objective with ANLS
approach, <code>onlineINMF</code> optimizes the same objective with online learning
strategy, where it updates mini-batches of \(H_i\) solving the NNLS
problem, and updates \(V_i\) and \(W\) with HALS multiplicative method.</p>
<p>This function allows online learning in 3 scenarios:</p>
<ol><li><p>Fully observed datasets;</p></li>
<li><p>Iterative refinement using continually arriving datasets;</p></li>
<li><p>Projection of new datasets without updating the existing factorization</p></li>
</ol></div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">onlineINMF</span><span class="op">(</span></span>
<span>  <span class="va">objectList</span>,</span>
<span>  newDatasets <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  project <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  maxEpoch <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  minibatchSize <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  maxHALSIter <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  Vinit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Winit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Ainit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Binit <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>objectList</dt>
<dd><p>list of input datasets. List elements should all be of the
same class. Viable classes include: matrix, dgCMatrix,
<a href="H5Mat.html">H5Mat</a>, <a href="H5SpMat.html">H5SpMat</a>.</p></dd>


<dt>newDatasets</dt>
<dd><p>Same requirements as for new arriving datasets. Default
<code>NULL</code> for scenario 1, specify for scenario 2 or 3.</p></dd>


<dt>project</dt>
<dd><p>Logical scalar, whether to run scenario 3. See description.
Default  <code>FALSE</code>.</p></dd>


<dt>k</dt>
<dd><p>Integer. Inner dimensionality to factorize the datasets into.
Default <code>20</code>.</p></dd>


<dt>lambda</dt>
<dd><p>Regularization parameter. Larger values penalize
dataset-specific effects more strongly (i.e. alignment should increase as
<code>lambda</code> increases). Default <code>5</code>.</p></dd>


<dt>maxEpoch</dt>
<dd><p>The number of epochs to iterate through. Default <code>5</code>.</p></dd>


<dt>minibatchSize</dt>
<dd><p>Total number of cells in each mini-batch. Default
<code>5000</code>.</p></dd>


<dt>maxHALSIter</dt>
<dd><p>Maximum number of block coordinate descent (HALS
algorithm) iterations to perform for each update of \(W\) and \(V\).
Default <code>1</code>. Changing this parameter is not recommended.</p></dd>


<dt>Vinit, Winit, Ainit, Binit</dt>
<dd><p>Pass the previous factorization result for
datasets existing in <code>objectList</code>, in order to run scenario 2 or 3. All
should have <code>length(objectList)</code> matrices inside. See description for
dimensionality of \(V_i\) and \(W_i\). \(A_i\) should be of size
\(k \times k\) and \(B_i\) should be of size \(m \times k\)</p></dd>


<dt>verbose</dt>
<dd><p>Logical scalar. Whether to show information and progress.
Default <code>TRUE</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A list of the following elements:</p><ul><li><p><code>H</code> - a list of result \(H_i\) matrices of size 
 \(n_i \times k\)</p></li>
<li><p><code>V</code> - a list of result \(V_i\) matrices</p></li>
<li><p><code>W</code> - the result \(W\) matrix</p></li>
<li><p><code>A</code> - a list of result \(A_i\) matrices, \(k \times k\)</p></li>
<li><p><code>B</code> - a list of result \(B_i\) matrices, \(m \times k\)</p></li>
<li><p><code>objErr</code> - the final objective error value.</p></li>
</ul></div>
    <div id="references">
    <h2>References</h2>
    <p>Joshua D. Welch and et al., Single-Cell Multi-omic Integration
Compares and Contrasts Features of Brain Cell Identity, Cell, 2019</p>
<p>Chao Gao and et al., Iterative single-cell multi-omic integration using
online learning, Nat Biotechnol., 2021</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Yichen Wang</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="co"># Scenario 1 with sparse matrices</span></span></span>
<span class="r-in"><span>    <span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu">onlineINMF</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">sparse1</span>, <span class="va">sparse2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Scenario 2 with H5 dense matrices</span></span></span>
<span class="r-in"><span>    <span class="va">h5dense1</span> <span class="op">&lt;-</span> <span class="fu"><a href="H5Mat.html">H5Mat</a></span><span class="op">(</span><span class="st">"filepath1.h5"</span>, <span class="st">"dataPath"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">h5dense2</span> <span class="op">&lt;-</span> <span class="fu"><a href="H5Mat.html">H5Mat</a></span><span class="op">(</span><span class="st">"filepath2.h5"</span>, <span class="st">"dataPath"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu">onlineINMF</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">h5dense1</span>, <span class="va">h5dense2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">h5dense3</span> <span class="op">&lt;-</span> <span class="fu"><a href="H5Mat.html">H5Mat</a></span><span class="op">(</span><span class="st">"filepath3.h5"</span>, <span class="st">"dataPath"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">res3</span> <span class="op">&lt;-</span> <span class="fu">onlineINMF</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">h5dense1</span>, <span class="va">h5dense2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       newDatasets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">h5dense3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       Vinit <span class="op">=</span> <span class="va">res2</span><span class="op">$</span><span class="va">V</span>, Winit <span class="op">=</span> <span class="va">res2</span><span class="op">$</span><span class="va">W</span>,</span></span>
<span class="r-in"><span>                       Ainit <span class="op">=</span> <span class="va">res2</span><span class="op">$</span><span class="va">A</span>, Binit <span class="op">=</span> <span class="va">res2</span><span class="op">$</span><span class="va">B</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>    <span class="co"># Scenario 3 with H5 sparse matrices</span></span></span>
<span class="r-in"><span>    <span class="va">h5sparse1</span> <span class="op">&lt;-</span> <span class="fu"><a href="H5SpMat.html">H5SpMat</a></span><span class="op">(</span><span class="st">"filepath1.h5"</span>, <span class="st">"group/data"</span>, <span class="st">"group/indices"</span>,</span></span>
<span class="r-in"><span>                         <span class="st">"group/indptr"</span>, nrow <span class="op">=</span> <span class="fl">4215</span>, ncol <span class="op">=</span> <span class="fl">6548</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">h5sparse2</span> <span class="op">&lt;-</span> <span class="fu"><a href="H5SpMat.html">H5SpMat</a></span><span class="op">(</span><span class="st">"filepath2.h5"</span>, <span class="st">"group/data"</span>, <span class="st">"group/indices"</span>,</span></span>
<span class="r-in"><span>                         <span class="st">"group/indptr"</span>, nrow <span class="op">=</span> <span class="fl">4215</span>, ncol <span class="op">=</span> <span class="fl">7451</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">res4</span> <span class="op">&lt;-</span> <span class="fu">onlineINMF</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">h5sparse1</span>, <span class="va">h5sparse2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">h5sparse3</span> <span class="op">&lt;-</span> <span class="fu"><a href="H5SpMat.html">H5SpMat</a></span><span class="op">(</span><span class="st">"filepath3.h5"</span>, <span class="st">"group/data"</span>, <span class="st">"group/indices"</span>,</span></span>
<span class="r-in"><span>                         <span class="st">"group/indptr"</span>, nrow <span class="op">=</span> <span class="fl">4215</span>, ncol <span class="op">=</span> <span class="fl">3456</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">res5</span> <span class="op">&lt;-</span> <span class="fu">onlineINMF</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">h5sparse1</span>, <span class="va">h5sparse2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       newDatasets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">h5sparse3</span><span class="op">)</span>, project <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                       Vinit <span class="op">=</span> <span class="va">res4</span><span class="op">$</span><span class="va">V</span>, Winit <span class="op">=</span> <span class="va">res4</span><span class="op">$</span><span class="va">W</span>,</span></span>
<span class="r-in"><span>                       Ainit <span class="op">=</span> <span class="va">res4</span><span class="op">$</span><span class="va">A</span>, Binit <span class="op">=</span> <span class="va">res4</span><span class="op">$</span><span class="va">B</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Andrew Robbins.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

